# Онлайн-касса для интернет-расчетов

## ФЗ-54

Закон 54-ФЗ "О применении контрольно-кассовой техники" с изменениями от 03.07.2016 предписывает интернет-сервисам при осуществлении расчетов с использованием электронного средства платежа (в т.ч. банковской картой) использовать контрольно-кассовую технику (ККТ) и отправлять покупателю электронный чек в момент расчета.

## Основные положения закона

* Необходимо использовать кассу нового образца с установленным фискальным накопителем (ФН).
* Необходимо заключить договор с оператором фискальных данных (ОФД) для передачи данных с ККТ в режиме онлайн в ФНС.
* Необходимо указывать в чеке все товарные позиции: наименование, цена, кол-во, сумма, ставка НДС.
* Необходимо подключить кассу к интернету.
* Необходимо выдавать чек покупателю непосредственно в момент расчета: для интернет-платежей с использованием банковской карты отправлять чек на e-mail или телефон.
* Необходимо менять ФН  в двух случаях:  
	* по истечении его срока действия;  
	* при заполнении памяти до истечения срока действия;  
		и хранить  его в  течение 5-ти лет.  
* Нет необходимости заключать договор с ЦТО на обслуживание.
* Нет необходимости предъявлять кассу инспектору ФНС, все регистрационные действия можно выполнить дистанционно в личном кабинете налогоплательщика на сайте ФНС.

## Онлайн-фискализация

Компания CloudPayments предлагает своим партнерам облачное решение "под ключ" для онлайн-фискализации интернет-платежей и, в рамках соблюдения закона 54-ФЗ для любого бизнеса, вы получите:

* Выделенную онлайн-кассу, зарегистрированную в ФНС на вашу компанию.
* Фискальный накопитель.
* Подключение к оператору фискальных данных.
* Автоматическое формирование чеков прихода и возврата в момент проведения расчета.
* Полный отчет по операциям в личном кабинете.

Касса будет находится в дата-центре 24/7, с подключением к интернету и питанию, работать круглосуточно и без перебоев. Наши сотрудники будут следить за ее техническим состоянием и своевременно менять фискальные накопители, а специальное программное обеспечение корректировать ошибки, открывать и закрывать смену по расписанию, в "облаке" ставить чеки в очередь при большой нагрузке и гарантированно отправлять покупателям.

![cloud-scheme](images/cloud-scheme.png)

## Онлайн-касса

Мы используем кассы  "MicroPay-ФАС" и "MicroPay-ФС"  с подключением к любому оператору фискальных данных.  

![cash_registers](images/cash_registers.jpeg)

## Демонстрация технологии

Пример оплаты по карте с автоматическим формированием чека и отправкой на электронный адрес или телефон.

<iframe src="pages/cash_register_demo.html" width=100%" height="600px" align="baseline"  hspace="2px" vspace="2px" frameborder="1" style="border: 2px" seamless></iframe>

### Стоимость

Стоимость услуг по онлайн-фискализации и сопровождению  можно узнать на сайте сервиса [CloudKassir](https://cloudkassir.ru) и/или уточнить у менеджера.

## Порядок подключения

Для подключения услуги онлайн-фискализации необходимо:

* Подключиться к сервису онлайн фискализации CloudKassir.
* Получить квалифицированную электронную подпись для работы с сайтом ФНС.
* Зарегистрироваться в личном кабинете налоговой службы:
    — для юридических лиц
    — для индивидуальных предпринимателей
* Заключить договор на онлайн-фискализацию с CloudKassir.

После подписания договора и оплаты счета вам будут предоставлены номер ККТ и ФН для регистрации в ФНС.


## Формат передачи данных для онлайн-чека

Данные для чека необходимо передавать в формате json по примеру ниже:

```shell
var receipt = {
			"Items": [//товарные позициии
				{
					"label": "Наименование товара 1", //наименование товара
					"price": 100.00, //цена
					"quantity": 1.00, //количество
					"amount": 100.00, //сумма
					"vat": 0, //ставка НДС
                    "method": 0, // тег-1214 признак способа расчета - признак способа расчета
    			    "object": 0, // тег-1212 признак предмета расчета - признак предмета товара, работы, услуги, платежа, выплаты, иного предмета расчета
                    "measurementUnit": "шт" //единица измерения
				}, {
					"label": "Наименование товара 2", //наименование товара
					"price": 200.00, //цена
					"quantity": 2.00, //количество
					"amount": 300.00, //сумма со скидкой 25%
					"vat": 10, //ставка НДС
                    "method": 0, // тег-1214 признак способа расчета - признак способа расчета
    			    "object": 0, // тег-1212 признак предмета расчета - признак предмета товара, работы, услуги, платежа, выплаты, иного предмета расчета
                    "measurementUnit": "шт" //единица измерения
				}, {
					"label": "Наименование товара 3", //наименование товара
					"price": 300.00, //цена
					"quantity": 3.00, //количество
					"amount": 900.00, //сумма
					"vat": 20, //ставка НДС
                    "method": 0, // тег-1214 признак способа расчета - признак способа расчета
    			    "object": 0, // тег-1212 признак предмета расчета - признак предмета товара, работы, услуги, платежа, выплаты, иного предмета расчета
                    "measurementUnit": "шт" //единица измерения
				}
			],
            "taxationSystem": 0, //система налогообложения; необязательный, если у вас одна система налогообложения
			"email": "user@example.com", //e-mail покупателя, если нужно отправить письмо с чеком
			"phone": "", //телефон покупателя в любом формате, если нужно отправить сообщение со ссылкой на чек
            "isBso": false, //чек является бланком строгой отчётности
		    "amounts":
	        {
		        "electronic": 1300.00, // Сумма оплаты электронными деньгами
		        "advancePayment": 0.00, // Сумма из предоплаты (зачетом аванса) (2 знака после запятой)
		        "credit": 0.00, // Сумма постоплатой(в кредит) (2 знака после запятой)
		        "provision": 0.00 // Сумма оплаты встречным предоставлением (сертификаты, др. мат.ценности) (2 знака после запятой)
	        }
		}


var data = { //содержимое элемента data
	"cloudPayments": {
      "customerReceipt": receipt, //онлайн-чек
	}
}
```

## Значения ставки НДС

* null или не указано — НДС не облагается
* 0 — НДС 0%
* 10 — НДС 10%
* 20 — НДС 20%
* 110 — расчетный НДС 10/110
* 120 — расчетный НДС 20/120

<aside class="notice">При указании ставки НДС будьте внимательны: "НДС 0%" и "НДС не облагается" — это не равнозначные варианты.</aside>

## Варианты системы налогообложения

* 0 — Общая система налогообложения
* 1 — Упрощенная система налогообложения (Доход)
* 2 — Упрощенная система налогообложения (Доход минус Расход)
* 3 — Единый налог на вмененный доход
* 4 — Единый сельскохозяйственный налог
* 5 — Патентная система налогообложения

<aside class="notice">При не указании системы налогообложения чек формируется с первой указанной при фискализации.</aside>

## Способы расчета

* 0 — Unknown, неизвестный способ расчета (значение по умолчанию. в электронной форме чека не отображается )
* 1 — FullPrepayment, Предоплата 100%
* 2 — PartialPrepayment, Предоплата
* 3 — AdvancePay, Аванс
* 4 — FullPay, Полный расчёт
* 5 — PartialPayAndCredit, Частичный расчёт и кредит
* 6 — Credit, Передача в кредит
* 7 — CreditPayment, Оплата кредита

## Предметы расчета

* 0 — Unknown, неизвестный предмет оплаты (значение по умолчанию. в электронной форме чека не отображается)
* 1 — Commodity, Товар
* 2 — ExcisedCommodity, Подакцизный товар
* 3 — Job, Работа
* 4 — Service, Услуга
* 5 — GamblingBet, Ставка азартной игры
* 6 — GamblingWin, Выигрыш азартной игры
* 7 — LotteryTicket, Лотерейный билет
* 8 — LotteryWin, Выигрыш лотереи
* 9 — RidAccess, Предоставление РИД
* 10 — Payment, Платеж
* 11 — AgentReward, Агентское вознаграждение
* 12 — Composite, Составной предмет расчета
* 13 — Another, Иной предмет расчета

## Условия успешного создания чека

* в чеке есть хотя бы одна позиция;
* во всех позициях указано наименование;
* цена и сумма позиции не отрицательная;
* общая сумма всех позиций больше нуля;
* входная строка наименования товара длиной не более 128 символов, более длинные строки будут обрезаны;
* указанная система налогообложения должна совпадать с одним из вариантов, зарегистрированных в ККТ;
* числовые значения переданы с точностью не более двух знаков после запятой;
    передан ИНН, если он требуется в документации.

Данные для онлайн-чека можно передавать в [параметры виджета](#parametry), при [оплате по криптограмме](#oplata-po-kriptogramme) или [токену](#oplata-po-tokenu-rekarring), при [подтверждении оплаты](#podtverzhdenie-oplaty), при [проведении возврата](#vozvrat-deneg), а также через специальное [API кассы](#kassy).

## Типы чеков и признак расчета

При передаче данных для онлайн-чека в виджет или методах оплаты система формирует 2 типа чеков в автоматическом режиме:

* Чек с признаком расчета "`Приход`" при проведении операции оплаты.
* Чек с признаком расчета "`Возврат прихода`" при проведении операции возврата.

## Отправка покупателю онлайн-чека

На выбор покупателя, кассовый чек необходимо отправить в письме на e-mail адрес или в СМС (Viber/WhatsApp/Telegram) сообщении на номер телефона. Чек может быть отправлен системой CloudPayments автоматически, при условии передачи e-mail адреса или номера телефона покупателя, или же вы самостоятельно можете отправлять чек — все необходимые реквизиты система передает в уведомлении [Receipt](#receipt).

## Момент отправки чека

Чек должен быть отправлен покупателю в момент расчета. Для [одностадийных платежей](#shemy-provideniya-platezha) чек формируется сразу же после прохождения оплаты, для [двустадийных](#shemy-provideniya-platezha) — при подтверждении операции.

## Тестирование онлайн-чека

При работе в тестовом режиме, кассовые чеки будут формироваться в демонстрационной ККТ с отладочным фискальным накопителем. Вы можете передать [данные для онлайн-чека](#format-peredachi-dannyh) при оплате в тестовом режиме и проверить работу онлайн-кассы. 